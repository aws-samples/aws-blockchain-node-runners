"use strict";(self.webpackChunkaws_blockchain_node_runners=self.webpackChunkaws_blockchain_node_runners||[]).push([[97],{9946:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>x,frontMatter:()=>d,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"Blueprints/Starknet","title":"Starknet","description":"","source":"@site/docs/Blueprints/Starknet.md","sourceDirName":"Blueprints","slug":"/Blueprints/Starknet","permalink":"/aws-blockchain-node-runners/docs/Blueprints/Starknet","draft":false,"unlisted":false,"editUrl":"https://github.com/aws-samples/aws-blockchain-node-runners/website/docs/Blueprints/Starknet.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Starknet"},"sidebar":"sidebar","previous":{"title":"Stacks","permalink":"/aws-blockchain-node-runners/docs/Blueprints/Stacks"},"next":{"title":"Sui","permalink":"/aws-blockchain-node-runners/docs/Blueprints/Sui"}}');var l=n(4848),i=n(8453);function r(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{Details:s}=t;return s||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:"sample-aws-blockchain-node-runner-app-for-starknet-nodes",children:"Sample AWS Blockchain Node Runner app for Starknet Nodes"})}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsx)(t.tr,{children:(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Contributed by"})})}),(0,l.jsx)(t.tbody,{children:(0,l.jsx)(t.tr,{children:(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.a,{href:"https://github.com/wojciechos",children:"@wojciechos"})})})})]}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.a,{href:"https://docs.starknet.io/documentation/",children:"Starknet"}),' is a "Layer 2" scaling solution for Ethereum leveraging zero knowledge proofs. This blueprint helps to deploy Starknet nodes (Juno) on AWS as RPC nodes. It is meant to be used for development, testing or Proof of Concept purposes.']}),"\n",(0,l.jsx)(t.h2,{id:"overview-of-deployment-architectures-for-single-node-setups",children:"Overview of Deployment Architectures for Single Node setups"}),"\n",(0,l.jsx)(t.h3,{id:"single-node-setup",children:"Single node setup"}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"Single Node Deployment",src:n(686).A+"",width:"1091",height:"311"})}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["A Starknet node deployed in the ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html",children:"Default VPC"})," continuously synchronizes with the ",(0,l.jsx)(t.a,{href:"https://docs.starknet.io/documentation/architecture_and_concepts/Network_Architecture/starknet_architecture_overview/",children:"Sequencer"})," through ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Internet_Gateway.html",children:"Internet Gateway"}),"."]}),"\n",(0,l.jsx)(t.li,{children:"The Starknet node is used by dApps or development tools internally from within the Default VPC. JSON RPC API is not exposed to the Internet directly to protect nodes from unauthorized access."}),"\n",(0,l.jsx)(t.li,{children:"You will need access to a fully-synced Ethereum RPC endpoint before running Juno."}),"\n",(0,l.jsx)(t.li,{children:"The Starknet node sends various monitoring metrics for both EC2 and Starknet nodes to Amazon CloudWatch."}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"additional-materials",children:"Additional Materials"}),"\n",(0,l.jsxs)(s,{children:[(0,l.jsx)("summary",{children:"Well-Architected Checklist"}),(0,l.jsxs)(t.p,{children:["This is the Well-Architected checklist for Stacks nodes implementation of the AWS Blockchain Node Runner app. This checklist takes into account questions from the ",(0,l.jsx)(t.a,{href:"https://aws.amazon.com/architecture/well-architected/",children:"AWS Well-Architected Framework"})," which are relevant to this workload. Please feel free to add more checks from the framework if required for your workload."]}),(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Pillar"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Control"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Question/Check"}),(0,l.jsx)(t.th,{style:{textAlign:"left"},children:"Remarks"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Security"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Network protection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Are there unnecessary open ports in security groups?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"There are no ports open to public. RPC port 6060 is open only IP addresses from the same VPC."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Traffic inspection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"AWS WAF could be implemented for traffic inspection. Additional charges will apply."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Compute protection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Reduce attack surface"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution uses Ubuntu Server 20.04 AMI. You may choose to run hardening scripts on it."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Enable people to perform actions at a distance"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution uses AWS Systems Manager for terminal session, not ssh ports."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Data protection at rest"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Use encrypted Amazon Elastic Block Store (Amazon EBS) volumes"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution uses encrypted Amazon EBS volumes."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Use encrypted Amazon Simple Storage Service (Amazon S3) buckets"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution uses Amazon S3 managed keys (SSE-S3) encryption."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Data protection in transit"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Use TLS"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"TLS is not used in this solution. Port 6060 is the only open port, but you may create HTTPS listener with self signed certificate if TLS is desired."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Authorization and access control"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Use instance profile with Amazon Elastic Compute Cloud (Amazon EC2) instances"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution uses AWS Identity and Access Management (AWS IAM) role instead of IAM user."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Following principle of least privilege access"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:'In all node types, root user is not used (using special user "ubuntu" instead).'})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Application security"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Security focused development practices"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"cdk-nag is being used with appropriate suppressions."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Cost optimization"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Service selection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Use cost effective resources"}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["1. AMD-based instances are used for Consensus and RPC node to save the costs. Consider compiling Graviton-based binaries to improve costs for compute.",(0,l.jsx)("br",{}),"2. Cost-effective EBS gp3 are preferred instead of io2."]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Cost awareness"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Estimate costs"}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["Single RPC node with ",(0,l.jsx)(t.code,{children:"m6a.2xlarge"})," EBS gp3 volume about 600 GB with On-Demand pricing will cost around US$323.29 per month in the US East (N. Virginia) region not including network requests for follower nodes. More analysis needed."]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Reliability"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Resiliency implementation"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Withstand component failures"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"This solution ues only for a single-node deployment. If the running node failed, you will need to undeploy the existing stack and re-deploy the node again."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Data backup"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How is data backed up?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Considering blockchain data is replicated by nodes automatically and Starknet nodes sync from start within an hour and a half, we don't use any additional mechanisms to backup the data."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Resource monitoring"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How are workload resources monitored?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Resources are being monitored using Amazon CloudWatch dashboards. Amazon CloudWatch custom metrics are being pushed via CloudWatch Agent."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Performance efficiency"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Compute selection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How is compute solution selected?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Compute solution is selected based on best price-performance, i.e. AWS AMD-based Amazon EC2 instances."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Storage selection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How is storage solution selected?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Storage solution is selected based on best price-performance, i.e. gp3 Amazon EBS volumes with optimal IOPS and throughput."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"}}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Architecture selection"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How is the best performance architecture selected?"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"We used a combination of recommendations from the Starknet community."})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Operational excellence"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Workload health"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"How is health of workload determined?"}),(0,l.jsxs)(t.td,{style:{textAlign:"left"},children:["We rely on metrics reported to CloudWatch by ",(0,l.jsx)(t.code,{children:"/opt/syncchecker.sh"})," script."]})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Sustainability"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Hardware & services"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"Select most efficient hardware for your workload"}),(0,l.jsx)(t.td,{style:{textAlign:"left"},children:"The solution uses AMD-powered instances. There is a potential to use AWS Graviton-based Amazon EC2 instances which offer the best performance per watt of energy use in Amazon EC2."})]})]})]})]}),"\n",(0,l.jsx)(t.h3,{id:"hardware-requirements",children:"Hardware Requirements"}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.strong,{children:"Minimum for Starknet node"})}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Instance type ",(0,l.jsx)(t.a,{href:"https://aws.amazon.com/ec2/instance-types/m6a/",children:"m6a.large"}),"."]}),"\n",(0,l.jsx)(t.li,{children:"250GB EBS gp3 storage with at least 3000 IOPS."}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.strong,{children:"Recommended for Starknet node"})}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["Instance type ",(0,l.jsx)(t.a,{href:"https://aws.amazon.com/ec2/instance-types/m6a/",children:"m6a.2xlarge"}),"."]}),"\n",(0,l.jsx)(t.li,{children:"600GB EBS gp3 storage with at least 3000 IOPS to store and upzip snapshots."}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"setup-instructions",children:"Setup Instructions"}),"\n",(0,l.jsx)(t.h3,{id:"open-aws-cloudshell",children:"Open AWS CloudShell"}),"\n",(0,l.jsx)(t.p,{children:"To begin, ensure you login to your AWS account with permissions to create and modify resources in IAM, EC2, EBS, VPC, S3, KMS, and Secrets Manager."}),"\n",(0,l.jsxs)(t.p,{children:["From the AWS Management Console, open the ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/cloudshell/latest/userguide/welcome.html",children:"AWS CloudShell"}),", a web-based shell environment. If unfamiliar, review the ",(0,l.jsx)(t.a,{href:"https://youtu.be/fz4rbjRaiQM",children:"2-minute YouTube video"})," for an overview and check out ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/cloudshell/latest/userguide/creating-vpc-environment.html",children:"CloudShell with VPC environment"})," that we'll use to test nodes API from internal IP address space."]}),"\n",(0,l.jsx)(t.p,{children:"Once ready, you can run the commands to deploy and test blueprints in the CloudShell."}),"\n",(0,l.jsx)(t.h3,{id:"clone-this-repository-and-install-dependencies",children:"Clone this repository and install dependencies"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/aws-samples/aws-blockchain-node-runners.git\ncd aws-blockchain-node-runners\nnpm install\n"})}),"\n",(0,l.jsx)(t.h3,{id:"deploy-single-node",children:"Deploy Single Node"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Make sure you are in the root directory of the cloned repository"}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"If you have deleted or don't have the default VPC, create default VPC"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"aws ec2 create-default-vpc\n"})}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.strong,{children:"NOTE:"})," ",(0,l.jsxs)(t.em,{children:["You may see the following error if the default VPC already exists: ",(0,l.jsx)(t.code,{children:"An error occurred (DefaultVpcAlreadyExists) when calling the CreateDefaultVpc operation: A Default VPC already exists for this account in this region."}),". That means you can just continue with the following steps."]})]}),"\n"]}),"\n",(0,l.jsxs)(t.ol,{start:"3",children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Configure your setup"}),"\n",(0,l.jsxs)(t.p,{children:["Create your own copy of ",(0,l.jsx)(t.code,{children:".env"})," file and edit it to update with your AWS Account ID and Region:"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"# Make sure you are in aws-blockchain-node-runners/lib/starknet\ncd lib/starknet\nnpm install\npwd\ncp ./sample-configs/.env-sample-full .env\nnano .env\n"})}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.strong,{children:"NOTE:"})," ",(0,l.jsxs)(t.em,{children:["Example configuration parameters are set in the local ",(0,l.jsx)(t.code,{children:".env-sample"})," file. You can find more examples inside ",(0,l.jsx)(t.code,{children:"sample-configs"})," directory."]})]}),"\n"]}),"\n",(0,l.jsxs)(t.ol,{start:"4",children:["\n",(0,l.jsx)(t.li,{children:"Deploy common components such as IAM role"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"pwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\nnpx cdk deploy starknet-common\n"})}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.strong,{children:"IMPORTANT:"})," ",(0,l.jsxs)(t.em,{children:["All AWS CDK v2 deployments use dedicated AWS resources to hold data during deployment. Therefore, your AWS account and Region must be ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/cdk/v2/guide/bootstrapping.html",children:"bootstrapped"})," to create these resources before you can deploy. If you haven't already bootstrapped, issue the following command:"]})]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"cdk bootstrap aws://ACCOUNT-NUMBER/REGION\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.ol,{start:"5",children:["\n",(0,l.jsxs)(t.li,{children:[(0,l.jsx)(t.strong,{children:"[OPTIONAL]"})," You can use Amazon Managed Blockchain (AMB) Access Ethereum node as L1 node. To do that, leave ",(0,l.jsx)(t.code,{children:"STARKNET_L1_ENDPOINT"})," URL empty and, deploy Amazon Managed Blockchain (AMB) Access Ethereum node. Wait about 35-70 minutes for the node to sync."]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"pwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\nnpx cdk deploy starknet-ethereum-l1-node --json --outputs-file starknet-ethereum-l1-node.json\n"})}),"\n",(0,l.jsxs)(t.p,{children:["To watch the progress, open the ",(0,l.jsx)(t.a,{href:"https://console.aws.amazon.com/managedblockchain/home",children:"AMB Web UI"}),", click the name of your target network from the list (Mainnet, Goerly, etc.) and watch the status of the node to change from ",(0,l.jsx)(t.code,{children:"Creating"})," to ",(0,l.jsx)(t.code,{children:"Available"}),"."]}),"\n",(0,l.jsxs)(t.ol,{start:"6",children:["\n",(0,l.jsx)(t.li,{children:"Deploy Starknet Full Node"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"pwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\nnpx cdk deploy starknet-single-node --json --outputs-file single-node-deploy.json\n"})}),"\n",(0,l.jsx)(t.p,{children:"After starting the node you will need to wait for the initial synchronization process to finish. When using snapshot, the node should become available within a couple of hours, but migh take about 3-4 days to sync it from block 0. To check the progress, you may use SSM to connect into EC2 first and watch the log like this:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"export INSTANCE_ID=$(cat single-node-deploy.json | jq -r '..|.nodeinstanceid? | select(. != null)')\necho \"INSTANCE_ID=\"$INSTANCE_ID\nexport AWS_REGION=us-east-1\naws ssm start-session --target $INSTANCE_ID --region $AWS_REGION\ntail -f /var/log/starknet/error.log\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"7",children:["\n",(0,l.jsx)(t.li,{children:"Test Starknet RPC API\nUse curl to query from within the node instance:"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:'export INSTANCE_ID=$(cat single-node-deploy.json | jq -r \'..|.node-instance-id? | select(. != null)\')\necho "INSTANCE_ID=" $INSTANCE_ID\nexport AWS_REGION=us-east-1\naws ssm start-session --target $INSTANCE_ID --region $AWS_REGION\n\ncurl --location \'http://localhost:6060\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n      "jsonrpc":"2.0",\n      "method":"starknet_chainId",\n      "params":[],\n      "id":1\n   }\'\n'})}),"\n",(0,l.jsx)(t.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,l.jsx)(t.p,{children:"A script on the Starknet node publishes current block and blocks behind metrics to CloudWatch metrics every 5 minutes. When the node is fully synced the blocks behind metric should get to 0.To see the metrics:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"Navigate to CloudWatch service (make sure you are in the region you have specified for AWS_REGION)"}),"\n",(0,l.jsxs)(t.li,{children:["Open Dashboards and select ",(0,l.jsx)(t.code,{children:"starknet-single-node-<network_id>"})," from the list of dashboards."]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"clear-up-and-undeploy-everything",children:"Clear up and undeploy everything"}),"\n",(0,l.jsx)(t.p,{children:"Destroy all Nodes and Common stacks"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"# Setting the AWS account id and region in case local .env file is lost\nexport AWS_ACCOUNT_ID=<your_target_AWS_account_id>\nexport AWS_REGION=<your_target_AWS_region>\n\npwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\n\n# Destroy Single Node\nnpx cdk destroy starknet-single-node\n\n# Destroy AMB Etheruem node\nnpx cdk destroy starknet-ethereum-l1-node\n\n# Delete all common components like IAM role and Security Group\nnpx cdk destroy starknet-common\n"})}),"\n",(0,l.jsx)(t.h2,{id:"faq",children:"FAQ"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"How to check the logs of the clients running on my Starknet node?"}),"\n"]}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.strong,{children:"NOTE:"})," ",(0,l.jsxs)(t.em,{children:["In this tutorial we chose not to use SSH and use Session Manager instead. That allows you to log all sessions in AWS CloudTrail to see who logged into the server and when. If you receive an error similar to ",(0,l.jsx)(t.code,{children:"SessionManagerPlugin is not found"}),", ",(0,l.jsx)(t.a,{href:"https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html",children:"install Session Manager plugin for AWS CLI"})]})]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"pwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\n\nexport INSTANCE_ID=$(cat single-node-deploy.json | jq -r '..|.nodeinstanceid? | select(. != null)')\necho \"INSTANCE_ID=\"$INSTANCE_ID\nexport AWS_REGION=us-east-1\naws ssm start-session --target $INSTANCE_ID --region $AWS_REGION\ntail -f /var/log/starknet/error.log\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsx)(t.li,{children:"How to check the logs from the EC2 user-data script?"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"pwd\n# Make sure you are in aws-blockchain-node-runners/lib/starknet\n\nexport INSTANCE_ID=$(cat single-node-deploy.json | jq -r '..|.nodeinstanceid? | select(. != null)')\necho \"INSTANCE_ID=\" $INSTANCE_ID\nexport AWS_REGION=us-east-1\naws ssm start-session --target $INSTANCE_ID --region $AWS_REGION\nsudo cat /var/log/cloud-init-output.log\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"3",children:["\n",(0,l.jsx)(t.li,{children:"How can I restart the Starknet service?"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-bash",children:"export INSTANCE_ID=$(cat single-node-deploy.json | jq -r '..|.nodeinstanceid? | select(. != null)')\necho \"INSTANCE_ID=\" $INSTANCE_ID\nexport AWS_REGION=us-east-1\naws ssm start-session --target $INSTANCE_ID --region $AWS_REGION\nsudo systemctl status starknet.service\nsudo systemctl restart starknet.service\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"4",children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Where to find the key juno directories?"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["The directory with binaries is ",(0,l.jsx)(t.code,{children:"/home/ubuntu/juno-source"}),"."]}),"\n",(0,l.jsxs)(t.li,{children:["The data directory of juno agent is ",(0,l.jsx)(t.code,{children:"/data"})]}),"\n"]}),"\n"]}),"\n"]})]})}function o(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(r,{...e})}):r(e)}const d={sidebar_label:"Starknet"},a="",c={},h=[{value:"Overview of Deployment Architectures for Single Node setups",id:"overview-of-deployment-architectures-for-single-node-setups",level:2},{value:"Single node setup",id:"single-node-setup",level:3},{value:"Additional Materials",id:"additional-materials",level:2},{value:"Hardware Requirements",id:"hardware-requirements",level:3},{value:"Setup Instructions",id:"setup-instructions",level:2},{value:"Open AWS CloudShell",id:"open-aws-cloudshell",level:3},{value:"Clone this repository and install dependencies",id:"clone-this-repository-and-install-dependencies",level:3},{value:"Deploy Single Node",id:"deploy-single-node",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Clear up and undeploy everything",id:"clear-up-and-undeploy-everything",level:2},{value:"FAQ",id:"faq",level:2}];function u(e){const t={h1:"h1",header:"header",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.header,{children:(0,l.jsx)(t.h1,{id:""})}),"\n","\n",(0,l.jsx)(o,{})]})}function x(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},686:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/Architecture-SingleNode-ee5e4a4f95b0f77d4c3f4a1ecdc2782e.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(6540);const l={},i=s.createContext(l);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);